# 我的听书 - 书源格式规范

本应用的书源格式兼容 **Legado（阅读3.0）** 和 **我的听书** 两种主流书源格式。

## 兼容性说明

| 格式 | 支持情况 | 说明 |
|------|----------|------|
| **Legado JSON** | ✅ 完整支持 | 阅读3.0 的 JSON 书源格式 |
| **我的听书 JSON** | ✅ 完整支持 | 我的听书的 JSON 书源 |
| **我的听书 JAR** | ❌ 不支持 | 需要 Android 运行环境 |

### 推荐书源仓库

- **全量源**: `https://legado.aoaostar.com/sources/b778fe6b.json` (含 65+ 有声源)
- **精品源**: `https://github.com/XIU2/Yuedu`

> 💡 **自动过滤**: 导入 Legado 全量源时，应用会自动筛选出有声书源（`bookSourceType: 1`），无需手动过滤。首次启动应用时会自动导入默认书源。

## 书源 JSON 格式

```json
{
  "sourceUrl": "https://www.example.com",
  "sourceName": "示例听书网",
  "sourceGroup": "有声小说",
  "sourceComment": "这是一个示例书源",
  
  "searchUrl": "/search?key={{key}}&page={{page}}",
  "searchList": "div.book-list > div.item",
  "searchName": "h3.title@text",
  "searchCover": "img.cover@src",
  "searchAuthor": "span.author@text",
  "searchIntro": "p.intro@text",
  "searchNoteUrl": "a.book-link@href",
  
  "chapterList": "ul.chapter-list > li > a",
  "chapterName": "@text",
  "chapterUrl": "@href",
  
  "audioUrlRule": "audio#player@src"
}
```

## 字段说明

### 基础信息

| 字段 | 必填 | 说明 |
|------|------|------|
| `sourceUrl` | ✅ | 源站基础地址，用于拼接相对URL |
| `sourceName` | ✅ | 书源名称，显示在UI上 |
| `sourceGroup` | ❌ | 书源分组，如"有声小说"、"评书相声" |
| `sourceComment` | ❌ | 书源说明/备注 |

### 搜索规则

| 字段 | 必填 | 说明 |
|------|------|------|
| `searchUrl` | ✅ | 搜索URL模板，支持 `{{key}}` `{{page}}` 占位符 |
| `searchList` | ✅ | 搜索结果列表的CSS选择器 |
| `searchName` | ✅ | 书名选择器 |
| `searchCover` | ❌ | 封面图选择器 |
| `searchAuthor` | ❌ | 作者选择器 |
| `searchIntro` | ❌ | 简介选择器 |
| `searchNoteUrl` | ✅ | 书籍详情页URL选择器 |

### 章节规则

| 字段 | 必填 | 说明 |
|------|------|------|
| `chapterList` | ✅ | 章节列表的CSS选择器 |
| `chapterName` | ✅ | 章节名称选择器 |
| `chapterUrl` | ✅ | 章节播放页URL选择器 |

### 音频规则

| 字段 | 必填 | 说明 |
|------|------|------|
| `audioUrlRule` | ✅ | 音频地址解析规则 |

## 选择器语法

### CSS选择器

```
div.class-name           # 选择 class
div#id-name              # 选择 id
div[attr="value"]        # 属性选择器
parent > child           # 直接子元素
parent child             # 后代元素
```

### 属性获取后缀

```
selector@text           # 获取文本内容
selector@html           # 获取HTML内容
selector@href           # 获取href属性
selector@src            # 获取src属性
selector@attr:data-url  # 获取自定义属性
```

### JSONPath（用于JSON接口）

```
$.data.list             # 获取 data.list 字段
$.data.list[0].name     # 获取第一项的name
```

### 正则表达式

```
@regex:url:"([^"]+)"    # 正则匹配
```

## 完整示例

### 网页书源示例

```json
{
  "sourceUrl": "https://www.tingbook.com",
  "sourceName": "听书网示例",
  "sourceGroup": "有声小说",
  "sourceComment": "示例书源，仅供参考",
  
  "searchUrl": "/search.html?searchword={{key}}&page={{page}}",
  "searchList": "div.search-list ul li",
  "searchName": "a.name@text",
  "searchCover": "img@src",
  "searchAuthor": "span.author@text",
  "searchIntro": "p.desc@text",
  "searchNoteUrl": "a.name@href",
  
  "chapterList": "div.playlist ul li a",
  "chapterName": "@text",
  "chapterUrl": "@href",
  
  "audioUrlRule": "audio source@src"
}
```

### JSON接口书源示例

```json
{
  "sourceUrl": "https://api.example.com",
  "sourceName": "API书源示例",
  "sourceGroup": "API源",
  
  "searchUrl": "/api/search?keyword={{key}}&page={{page}}",
  "searchList": "$.data.list",
  "searchName": "$.name",
  "searchCover": "$.cover",
  "searchAuthor": "$.author",
  "searchNoteUrl": "$.detailUrl",
  
  "chapterList": "$.chapters",
  "chapterName": "$.title",
  "chapterUrl": "$.playUrl",
  
  "audioUrlRule": "$.audioUrl"
}
```

## Legado (阅读3.0) 格式

本应用兼容 Legado 格式的有声书源（`bookSourceType: 1`）：

```json
{
  "bookSourceName": "有声书源示例",
  "bookSourceType": 1,
  "bookSourceUrl": "https://api.example.com",
  "bookSourceGroup": "有声",
  
  "searchUrl": "/api/search,{'method': 'POST', 'body': '{\"key\":\"{{key}}\"}'}",
  "ruleSearch": {
    "bookList": "$.data[*]",
    "name": "$.title",
    "author": "$.author",
    "coverUrl": "$.cover",
    "bookUrl": "$.detailUrl"
  },
  "ruleContent": {
    "content": "$.audioUrl"
  }
}
```

### Legado 特殊语法

| 语法 | 示例 | 说明 |
|------|------|------|
| **模板变量** | `{{key}}`, `{{page}}` | 搜索关键词、页码 |
| **JSONPath** | `$.data`, `$..items[*]` | JSON 数据提取 |
| **CSS选择器** | `@css:div.list > a` | HTML 解析 |
| **POST请求** | `url,{'method':'POST','body':'...'}` | URL后附加配置 |
| **编码** | `{"charset":"gbk"}` | 指定字符编码 |

## 订阅源格式

订阅源是一个 JSON 数组，包含多个书源：

```json
[
  { "sourceUrl": "...", "sourceName": "书源1", ... },
  { "sourceUrl": "...", "sourceName": "书源2", ... }
]
```

## 获取书源

### 官方推荐

- **我的听书官方源**: 由"我的听书"APP官方维护
- **镜像源（国内）**: 国内镜像，访问更快

### 自定义添加

1. 打开书源管理
2. 切换到"添加书源"标签
3. 输入书源订阅URL（.json格式）
4. 点击添加

## 注意事项

1. 书源仅用于学习研究，请支持正版
2. 部分源可能失效，建议定期刷新订阅
3. 网络原因可能导致部分源无法访问
4. 书源规则随网站更新可能失效
