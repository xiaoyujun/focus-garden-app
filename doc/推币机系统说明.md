# 推币机徽章系统

## 功能概述

将原有的直接购买徽章模式改造为推币机（扭蛋机）抽取模式，增加游戏趣味性和收集乐趣。

## 核心机制

### 三台推币机

系统同时提供 **3 台推币机**，每台机器拥有不同的特征，影响抽取结果的概率分布。

### 五种机器特征

| 特征名称 | 图标 | 效果说明 |
|---------|------|---------|
| **幸运之星** | ⭐ | 稀有度越高的徽章抽中概率越大（稀有×2、史诗×2.5、传奇×3） |
| **回收大师** | 🔄 | 更容易抽出已拥有的徽章，但重复徽章返还 **50%** 金币 |
| **平民福音** | 🍀 | 低级徽章概率大幅提升，且投币价格打 **7 折** |
| **万象之轮** | 🌈 | 所有分类的徽章均匀分布，适合补全特定系列 |
| **双子星座** | ✨ | 有 **35%** 概率一次抽出两个徽章 |

### 每周刷新

- 每周一凌晨 00:00 自动刷新三台机器的特征
- 同一周内三台机器的特征组合固定不变
- 基于周日期的种子随机，确保一致性

## 抽取规则

### 价格

- **基础价格**：80 金币/次
- **平民福音机器**：56 金币/次（70% 折扣）

### 重复徽章处理

- 抽到已拥有的徽章视为"重复"
- **回收大师机器**：返还 50% 金币
- **其他机器**：返还 30% 金币

### 概率计算

1. 根据机器特征调整各徽章的权重
2. 使用加权随机算法选择最终结果
3. 双子星座特征会额外触发第二次抽取

## 界面设计

### 推币机页面

- 展示三台机器卡片（1号机、2号机、3号机）
- 特征为隐藏状态，只显示图标和颜色，名称显示为"??? 神秘特征"
- 玩家需要通过图标和颜色猜测机器的实际特征
- 右上角问号按钮可查看所有可能的特征类型说明
- 投币按钮显示当前价格
- 抽取时播放弹跳动画

### 收藏页面

- 网格展示已获得的徽章
- 支持按分类筛选
- 显示稀有度标签

### 结果弹窗

- 展示抽取到的徽章
- 显示稀有度和是否为新徽章
- 重复徽章显示返还金额

## 数据存储

```javascript
// localStorage 键名
'focus-garden-badges'    // 已拥有徽章
'focus-garden-machines'  // 机器状态和历史
```

### 存储结构

```javascript
{
  lastRefreshWeek: '2024-12-02',  // 上次刷新的周一日期
  machines: [
    { id: 'machine_1', slot: 1, trait: {...}, drawCount: 5 },
    { id: 'machine_2', slot: 2, trait: {...}, drawCount: 3 },
    { id: 'machine_3', slot: 3, trait: {...}, drawCount: 8 }
  ],
  drawHistory: [...]  // 最近 50 条抽取记录
}
```

## 文件变更

| 文件 | 变更内容 |
|-----|---------|
| `src/stores/badgeStore.js` | 新增推币机配置、状态管理、抽取逻辑 |
| `src/views/BadgeShop.vue` | 重写为推币机 UI，添加动画效果 |

## 后续优化建议

1. **保底机制**：连续 N 次未出新徽章后提升概率
2. **每日免费抽**：每天可免费抽一次
3. **连抽功能**：一键投币 10 次
4. **抽取历史页面**：查看详细抽取记录
5. **成就系统**：集齐某系列解锁特殊奖励
